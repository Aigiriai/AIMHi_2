2025-08-21T12:46:41Z info: Creating Autoscale service
starting up user application
forwarding local port 5000 to external port 80 (mapped as 1104)
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.js
â˜ï¸ Object Storage backup service initialized
12:47:14 PM [express] ğŸ“¦ Initializing unified database manager...
âš ï¸ DEPRECATED: sqlite-db.ts is deprecated. Use unified-db-manager.ts instead
â±ï¸ DB_MANAGER: Starting initialization with 15s timeout
  heapTotal: 68681728,
ğŸ” DB_MANAGER[qm8758980]: Current state - initialized: false, complete: false, initializing: false
ğŸ“‚ Multiple call contexts loaded from disk (1 candidates)
ğŸ“ DB_MANAGER: Database path: /home/runner/workspace/data/production.db (NODE_ENV: production)
âœ… DB_MANAGER: Backup service loaded in 15ms
ğŸ“Š DB_MANAGER: Environment - NODE_ENV: production, CWD: /home/runner/workspace
ğŸŒ RESTORE: Environment: production
ğŸ”„ DB_MANAGER: Proceeding with smart database initialization...
12:47:14 PM [express] Initializing consolidated Node.js backend...
ğŸ›¡ï¸ Attempting to restore database from Object Storage...
âœ… Downloaded 147456 bytes using downloadAsBytes method
  rss: 144285696,
ğŸ”„ RESTORE: Starting database restoration process...
ğŸš€ DB_MANAGER[qm8758980]: Starting new initialization process...
ğŸ”„ Initializing call context on app startup...
  heapUsed: 42396224,
}
ï¿½ DB_MANAGER: Starting unified database initialization...
ğŸš€ DB_MANAGER: Racing initialization vs timeout...
ğŸ” DB_MANAGER[qm8758980]: Getting database instance (PID: 37)
âœ… Downloaded 290816 bytes using downloadAsBytes method
ğŸŒ DB_MANAGER: Environment: production
ğŸ­ DB_MANAGER: Production mode - always attempt restore from latest backup first
12:47:14 PM [express] ğŸ”— AI calling configured for direct webhooks (no tunnel required)
â˜ï¸ Downloading database backup: database-backups/prod/pre-migration-production-2025-08-21T12-41-29-619Z.db
ğŸ”„ Restoring most recent backup: pre-migration-production-2025-08-21T12-41-29-619Z.db (modified: 1970-01-01T00:00:00.000Z)
ğŸ”„ DB_MANAGER: ========== BACKUP RESTORATION ATTEMPT ==========
ğŸ“Š RESTORE: No existing database found at target path
â˜ï¸ RESTORE: Attempting restoration from Object Storage...
ğŸ”§ Preparing database for restoration - closing connections and cleaning up WAL files...
  external: 3943061,
âœ… Database preparation complete - ready for restoration
ğŸ” DB_MANAGER: Integrity check result: ok
ğŸ“ RESTORE: Data directory already exists: /home/runner/workspace/data
12:47:14 PM [express] ğŸš€ SERVER: Starting server (database initializing in background)...
ğŸ’¾ DB_MANAGER: Memory usage before init: {
ğŸ‰ DB_MANAGER: ========== BACKUP RESTORATION SUCCESS! ==========
âœ… DB_MANAGER: restoreFromLatestBackup completed in 673ms with result: true
ğŸ“ RESTORE: Target database path: /home/runner/workspace/data/production.db
âœ… Downloaded 147456 bytes using downloadAsBytes method
ğŸ”„ Trying downloadAsBytes method as alternative...
  2. production-backup-2025-08-21T12-44-15-530Z.db (modified: 1970-01-01T00:00:00.000Z)
âœ… DB_MANAGER: Table 'organizations' exists (0 records)
  arrayBuffers: 438362
ğŸ’¾ MIGRATION_SYSTEM: Creating backup at /home/runner/workspace/database-backup-production-2025-08-21T12-47-14-924Z.db...
  â€¢ Chaitanya Baitule (5%)
âœ… Restored context for Sudhir from previous session
ğŸ” DEBUG: Organizations in restored backup: []
ğŸ” DB_MANAGER: Opening and validating existing database...
âœ… DB_MANAGER: Table 'candidates' exists (0 records)
     ğŸ“‹ Organizations in production-backup-2025-08-21T12-44-15-530Z.db: AIM Hi System (aimhi.app), Aigiri (null)
ğŸ“‹ STARTUP_VALIDATOR: Table jobs has 25 columns
ğŸ“ DB_MANAGER: Target database path: /home/runner/workspace/data/production.db
â˜ï¸ Downloading database backup: database-backups/prod/pre-migration-production-2025-08-21T12-41-29-619Z.db
âœ… RESTORE: Database successfully restored from Object Storage backup
âš ï¸  STARTUP_VALIDATOR: 1 essential columns missing from existing tables
ğŸ“Š STARTUP_VALIDATOR: These issues will be resolved before serving any user requests
ğŸ“‹ Found 2 prod backup files, checking most recent:
ğŸ“‹ STARTUP_VALIDATOR: Checking for missing columns in existing tables...
âœ… Database backup uploaded successfully: database-backups/prod/pre-migration-production-2025-08-21T12-47-14-924Z.db
ğŸ” DB_MANAGER: Checking essential table structure...
âœ… Database backup downloaded successfully to: /tmp/debug_backup_0.db
ğŸ”„ DB_MANAGER: Calling restoreFromLatestBackup...
ğŸ“‹ STARTUP_VALIDATOR: Step 1/5 - Analyzing current database schema...
ğŸ“¦ DB_MANAGER: Loading backup restoration service...
ğŸ“‹ STARTUP_VALIDATOR: Table candidates has 14 columns
ğŸ“‚ Loaded 1 candidate contexts for AI calling
ğŸ”„ DB_MANAGER: Attempting restoration from latest production backup before any other action...
ğŸ”„ Trying downloadAsBytes method as alternative...
ğŸ“‹ STARTUP_VALIDATOR: Checking for missing columns in existing tables...
ğŸ“Š DB_MANAGER: Last modified: 2025-08-21T12:47:14.908Z
ğŸš€ MIGRATION_SYSTEM: Applying migration auto_migration_1755780435208...
â˜ï¸ MIGRATION_SYSTEM: Uploaded pre-migration backup to Object Storage as database-backups/prod/pre-migration-production-2025-08-21T12-47-14-924Z.db
   - Current tables: 23
âœ… Database restored from most recent backup: pre-migration-production-2025-08-21T12-41-29-619Z.db
     1. Missing essential column: candidates.settings - required for candidate-specific configuration (TEXT/JSON, default: "{}") - with schema-validated datatypes
âœ… DB_MANAGER: Table 'users' exists (0 records)
âœ… Database backup downloaded successfully to: /tmp/debug_backup_1.db
ğŸ”„ Trying downloadAsBytes method as alternative...
ğŸ” STARTUP_VALIDATOR: Performing detailed schema analysis...
ğŸ“Š STARTUP_VALIDATOR: Schema analysis complete - 1 issues identified for automatic resolution
ğŸ“Š MIGRATION_SYSTEM: Schema analysis complete
ğŸ“„ STARTUP_VALIDATOR: Backup creation skipped in current environment
ğŸ”„ MIGRATION_SYSTEM: Starting auto-migration for production environment
ğŸ“‹ STARTUP_VALIDATOR: Checking for missing tables...
âœ… MIGRATION_SYSTEM: Migrations table ready
âœ… Existing database connections closed and checkpointed
   - Missing tables: 0
ğŸ” DB_MANAGER: Performing integrity check...
ğŸ“‚ Call context loaded from disk
ğŸ’¾ DB_MANAGER: Memory usage after init: {
âœ… DB_MANAGER: Restored database passed integrity check
âœ… DB_MANAGER: Initialization completed successfully in 991ms
   - Missing columns: 1
ğŸ’¾ STARTUP_VALIDATOR: Step 2/5 - Creating safety backup before schema changes...
     ğŸ“‹ Organizations in pre-migration-production-2025-08-21T12-41-29-619Z.db: None
âœ… STARTUP_VALIDATOR: All expected tables are present
  heapTotal: 75653120,
   - Needs migration: true
ğŸ“„ STARTUP_VALIDATOR: Backup creation skipped (0ms) - appropriate for current environment
   - Missing tables: 0
   - Extra tables: 0
âœ… DB_MANAGER: Table 'jobs' exists (0 records)
ğŸ” MIGRATION_SYSTEM: Checking for schema drift...
ğŸ“ DB_MANAGER: Database path: /home/runner/workspace/data/production.db
â˜ï¸ Uploading database backup: database-backups/prod/pre-migration-production-2025-08-21T12-47-14-924Z.db (144KB)
âœ… MIGRATION_SYSTEM: Auto-migration completed successfully
   - Expected tables: 23
ğŸ—‘ï¸ STARTUP_VALIDATOR: Checking for extra tables that need cleanup...
ğŸ—‘ï¸ STARTUP_VALIDATOR: Checking for extra tables that need cleanup...
âœ… DB_MANAGER: Successfully restored from backup
   - Current tables: 23
ğŸ“‹ STARTUP_VALIDATOR: Checking for missing tables...
âœ… DB_MANAGER[qm8758980]: New initialization completed successfully (992ms)
ğŸ“Š RESTORE: Restored database size: 144KB
âš ï¸  STARTUP_VALIDATOR: Found 1 schema issues requiring fixes:
ğŸ”§ STARTUP_VALIDATOR: Step 3/5 - Applying comprehensive schema migrations...
ğŸ¯ STARTUP_VALIDATOR: Database schema is now fully compatible with application code
  heapUsed: 48352608,
ğŸ“Š DB_MANAGER: Database file size: 144KB
ğŸ—‘ï¸ MIGRATION_SYSTEM: Processing schema cleanup...
   - Schema cleanup: NO
âœ… Database backup downloaded successfully to: /home/runner/workspace/data/production.db
âœ… STARTUP_VALIDATOR: Database integrity check passed
ğŸ‰ STARTUP_VALIDATOR: Schema analysis complete - database is perfect!
ğŸ” MIGRATION_SYSTEM: Checking for schema drift...
ğŸ“‹ STARTUP_VALIDATOR: Table organizations has 18 columns
ğŸ“‹ STARTUP_VALIDATOR: Table users has 18 columns
12:47:14 PM [express] Server running on port 5000 with AI calling support
â˜ï¸ Downloading database backup: database-backups/prod/production-backup-2025-08-21T12-44-15-530Z.db
âœ… DB_MANAGER: Restored production database validated successfully
âœ… STARTUP_VALIDATOR: All expected tables are present
âš™ï¸ DB_MANAGER: Configuring pragmas for existing database...
ğŸ‰ STARTUP_VALIDATOR: Schema validation completed successfully in 291ms
âœ… MIGRATION_SYSTEM: Migration auto_migration_1755780435208 applied successfully
ğŸ“‹ STARTUP_VALIDATOR: Schema analysis completed in 2ms
   - Current tables: 23
âœ… STARTUP_VALIDATOR: No extra tables found
ğŸ” DB_MANAGER: Verifying restored database integrity...
  1. pre-migration-production-2025-08-21T12-41-29-619Z.db (modified: 1970-01-01T00:00:00.000Z)
ğŸ“‹ STARTUP_VALIDATOR: Table candidates has 15 columns
   - Missing columns: candidates.settings
âœ… STARTUP_VALIDATOR: All essential columns are present
  rss: 155688960,
   - Missing tables: 0
   - Description: Auto-generated schema alignment - 1 columns, 0 tables added, 0 tables removed
âœ… MIGRATION_SYSTEM: Migration completed in 2ms
ğŸ” STARTUP_VALIDATOR: Performing detailed schema analysis...
  arrayBuffers: 767347
ğŸ“Š MIGRATION_SYSTEM: Schema analysis complete
âš ï¸ MIGRATION_SYSTEM: Schema drift detected - applying fixes...
   - Description: Auto-generated schema alignment - 1 columns, 0 tables added, 0 tables removed
ğŸ”„ MIGRATION_SYSTEM: Generated comprehensive schema alignment migration:
12:47:14 PM [express] Direct webhook domain: aimhi.aigiri.ai
ğŸ”§ MIGRATION_SYSTEM: Initializing migrations table...
ğŸ” STARTUP_VALIDATOR: Performing database integrity check...
   - Environment: production
âœ… STARTUP_VALIDATOR: No extra tables found
   - Version: 1
ğŸ” MIGRATION_SYSTEM: Checking for schema drift...
âœ… STARTUP_VALIDATOR: All schema issues resolved successfully (verified in 1ms)
ğŸ“‹ STARTUP_VALIDATOR: Table jobs has 25 columns
âœ… DB_MANAGER: Database integrity check passed
   - Executing: ALTER TABLE candidates ADD COLUMN settings TEXT DE...
ğŸ“Š STARTUP_VALIDATOR: Applied 1 schema fixes automatically
   - Needs migration: true
ğŸ“„ STARTUP_VALIDATOR: Step 5/5 - Backup update skipped (appropriate for current environment)
ğŸ”„ DB_MANAGER: Running schema validation on existing database...
   - Needs migration: false
âœ… SCHEMA_MANAGER: Database schema is ready
ğŸ“Š STARTUP_VALIDATOR: Found 23 existing tables
ğŸš€ STARTUP_VALIDATOR: Application ready - zero runtime validation overhead guaranteed
   - Missing columns: 0
   - Missing tables: 
âœ… DB_MANAGER: Database initialization completed successfully
ğŸ§¹ DB_MANAGER[qm8758980]: Initialization mutex cleaned up
ğŸ“Š STARTUP_VALIDATOR: Validation approach - startup-only (zero runtime overhead)
ğŸ“‹ STARTUP_VALIDATOR: Table organizations has 18 columns
âœ… MIGRATION_SYSTEM: Backup created successfully
}
12:47:15 PM [express] âœ… DATABASE: Database initialization completed successfully
âœ… DB_MANAGER: Existing database schema validation completed in 291ms
ğŸ”§ SCHEMA_MANAGER: Ensuring database schema for production environment
   - Extra tables: 0
ğŸ” STARTUP_VALIDATOR: Step 4/5 - Verifying migration success and schema integrity...
  external: 4487153,
ğŸ§¹ DB_MANAGER: Timeout timers cleaned up after successful initialization
   - Missing columns: 1
ğŸ“‹ DB_MANAGER: Applied 1 schema fixes to existing database
ğŸ“Š MIGRATION_SYSTEM: Schema analysis complete
âœ… STARTUP_VALIDATOR: Migration system completed successfully in 287ms
   - Expected tables: 23
âœ… STARTUP_VALIDATOR: Database integrity check passed
âœ… DB_MANAGER: Existing database validated successfully in 292ms
ğŸ” STARTUP_VALIDATOR: Starting comprehensive schema validation for production environment
ğŸ“Š STARTUP_VALIDATOR: Found 23 existing tables
ğŸ“‹ STARTUP_VALIDATOR: Table users has 18 columns
   - Expected tables: 23
   - Extra tables: 0
   - Up statements: 1
ğŸ” STARTUP_VALIDATOR: Performing database integrity check...
2025-08-21T12:47:18Z info: Waiting for service to be ready
2025-08-21T12:47:20Z info: Deployment successful